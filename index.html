<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø±Ø´Ø¯ Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ø°ÙƒÙŠ | Ù…Ø­Ù…Ø¯ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --primary: #1b5e20; --accent: #c69c6d; --bg: #f8f9fa; }
        body { margin: 0; font-family: 'Segoe UI', Tahoma, sans-serif; height: 100vh; background: var(--bg); overflow: hidden; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 9999; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center; padding: 30px; box-sizing: border-box;
        }

        .main-btn {
            background: var(--primary); color: white; border: none; padding: 18px 45px;
            border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer;
            box-shadow: 0 10px 25px rgba(27, 94, 32, 0.3); transition: 0.3s;
        }

        /* ØªÙ†Ø¨ÙŠÙ‡ Ø³Ø§ÙØ§Ø±ÙŠ Ø¢ÙŠÙÙˆÙ† */
        #safari-alert {
            display: none; background: #fff3cd; color: #856404; padding: 15px;
            border-radius: 12px; margin-top: 20px; font-size: 14px; border: 1px solid #ffeeba;
        }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        .top-bar {
            position: absolute; top: 15px; left: 10px; right: 10px; z-index: 1000;
            background: white; padding: 12px 20px; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 10px;
        }
        .pulse { height: 12px; width: 12px; background: #2ecc71; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); } }

        .bottom-panel { position: absolute; bottom: 25px; left: 10px; right: 10px; z-index: 1000; }
        .search-results { background: white; border-radius: 12px; max-height: 180px; overflow-y: auto; display: none; margin-bottom: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 1px solid #eee; }
        .res-item { padding: 15px; border-bottom: 1px solid #eee; font-size: 15px; cursor: pointer; color: #333; text-align: right; }
        
        .search-input { width: 100%; padding: 16px; border-radius: 15px; border: none; box-shadow: 0 4px 20px rgba(0,0,0,0.15); font-size: 16px; margin-bottom: 10px; outline: none; box-sizing: border-box; text-align: right; }
        .stats-box { background: var(--primary); color: white; padding: 15px; border-radius: 18px; display: flex; justify-content: space-around; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .stat-item b { display: block; font-size: 19px; }
        .stat-item span { font-size: 11px; opacity: 0.9; }
    </style>
</head>
<body>

<div id="welcome-screen">
    <div style="font-size: 60px; margin-bottom: 10px;">ğŸ•‹</div>
    <h2 style="color: var(--primary); margin: 0;">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ø°ÙƒÙŠ</h2>
    <p style="color: #666; font-size: 15px; margin: 15px 0 25px; line-height: 1.5;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø­Ù…Ø¯<br>Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡ ÙˆØ³Ù†ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…ÙƒØ§Ù†Ùƒ ÙÙˆØ±Ø§Ù‹</p>
    <button class="main-btn" id="startBtn" onclick="requestLocation()">Ø§Ø¨Ø¯Ø£ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
    
    <div id="safari-alert">
        <b>ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ø¢ÙŠÙÙˆÙ†:</b><br>
        Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ <b>AA</b> ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„Ø±Ø§Ø¨Ø· Ø«Ù… <b>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</b> ÙˆØ§Ø¬Ø¹Ù„ Ø§Ù„ÙˆØµÙˆÙ„ <b>Ø³Ù…Ø§Ø­</b>.
    </div>
</div>

<div class="top-bar">
    <div class="pulse"></div>
    <span id="currentPlaceName" style="font-weight: bold; font-size: 14px; color: #333;">Ø£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ: ÙÙŠ Ø±Ø­Ø§Ø¨ Ø§Ù„Ø­Ø±Ù…</span>
</div>

<div id="map"></div>

<div class="bottom-panel">
    <div id="searchResults" class="search-results"></div>
    <input type="text" class="search-input" id="searchInput" placeholder="Ø£ÙŠÙ† ÙˆØ¬Ù‡ØªÙƒØŸ (Ø²Ù…Ø²Ù…ØŒ Ø¨Ø§Ø¨ØŒ Ø§Ù„Ù…Ø³Ø¹Ù‰...)" oninput="search()">
    <div class="stats-box">
        <div class="stat-item"><b id="dVal">0</b><span>Ù…ØªØ± Ù„Ù„Ù‡Ø¯Ù</span></div>
        <div class="stat-item"><b id="sVal">0</b><span>Ø®Ø·ÙˆØ© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹</span></div>
    </div>
</div>

<script>
    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù…Ø§ÙƒÙ†
    const destinations = [
        { name: "Ø§Ù„ÙƒØ¹Ø¨Ø© Ø§Ù„Ù…Ø´Ø±ÙØ© - ØµØ­Ù† Ø§Ù„Ù…Ø·Ø§Ù", lat: 21.4225, lng: 39.8262 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ (79)", lat: 21.4214, lng: 39.8235 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² (1)", lat: 21.4204, lng: 39.8257 },
        { name: "Ø¬Ø¨Ù„ Ø§Ù„ØµÙØ§ (Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø¹Ù‰)", lat: 21.4215, lng: 39.8275 },
        { name: "Ø¬Ø¨Ù„ Ø§Ù„Ù…Ø±ÙˆØ© (Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø¹Ù‰)", lat: 21.4255, lng: 39.8282 },
        { name: "Ù…Ø´Ø±Ø¨ÙŠØ§Øª Ø²Ù…Ø²Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", lat: 21.4228, lng: 39.8265 },
        { name: "Ø­Ù…Ø§Ù…Ø§Øª Ø§Ù„Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©", lat: 21.4245, lng: 39.8305 }
    ];

    const haramDefault = [21.4225, 39.8262];
    let map = L.map('map', { zoomControl: false }).setView(haramDefault, 18);
    let userMarker, pathLine = L.polyline([], {color: '#c69c6d', weight: 6, opacity: 0.8}).addTo(map);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    function requestLocation() {
        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙÙˆØ±Ø§Ù‹ Ù„ÙƒØ³Ø± Ø§Ù„Ø¬Ù…ÙˆØ¯
        document.getElementById('welcome-screen').style.display = 'none';
        
        if (navigator.geolocation) {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ø¹ ØªØªØ¨Ø¹ Ù…Ø³ØªÙ…Ø±
            navigator.geolocation.watchPosition(updatePosition, handleError, {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            });
        } else {
            handleError();
        }
    }

    function updatePosition(pos) {
        const uPos = [pos.coords.latitude, pos.coords.longitude];
        
        if (!userMarker) {
            userMarker = L.circleMarker(uPos, {radius: 10, color: 'white', weight: 3, fillOpacity: 1, fillColor: '#007aff'}).addTo(map);
            map.panTo(uPos);
        } else {
            userMarker.setLatLng(uPos);
        }

        // ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø¯Ù‚ÙŠÙ‚
        let placeName = "Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ù…";
        destinations.forEach(d => {
            if(map.distance(uPos, [d.lat, d.lng]) < 40) placeName = d.name;
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ
        document.getElementById('currentPlaceName').innerText = "Ø£Ù†Øª Ù‡Ù†Ø§ ÙÙŠ (" + placeName + ")";
    }

    function handleError(err) {
        console.warn("Geolocation fallback activated.");
        // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ù€ GPS Ù†Ø¶Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø­Ø±Ù… Ù„ÙŠØªÙ…ÙƒÙ† Ù…Ù† ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        if (!userMarker) {
            userMarker = L.circleMarker(haramDefault, {radius: 10, color: 'white', weight: 3, fillOpacity: 1, fillColor: '#888'}).addTo(map);
        }
        document.getElementById('currentPlaceName').innerText = "Ø£Ù†Øª Ù‡Ù†Ø§ ÙÙŠ (Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ù… - Ù…ÙˆÙ‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ)";
        if(err && err.code === 1) document.getElementById('safari-alert').style.display = 'block';
    }

    function search() {
        let q = document.getElementById('searchInput').value.toLowerCase();
        let res = document.getElementById('searchResults');
        res.innerHTML = '';
        if(!q) { res.style.display = 'none'; return; }

        const filtered = destinations.filter(d => d.name.includes(q));
        filtered.forEach(d => {
            let item = document.createElement('div');
            item.className = 'res-item';
            item.innerText = d.name;
            item.onclick = () => {
                let start = userMarker ? userMarker.getLatLng() : haramDefault;
                let end = [d.lat, d.lng];
                pathLine.setLatLngs([start, end]);
                let dist = map.distance(start, end);
                document.getElementById('dVal').innerText = dist.toFixed(0);
                document.getElementById('sVal').innerText = Math.round(dist / 0.7);
                res.style.display = 'none';
                map.fitBounds(pathLine.getBounds(), {padding: [70,70]});
            };
            res.appendChild(item);
        });
        res.style.display = filtered.length > 0 ? 'block' : 'none';
    }
</script>
</body>
</html>
