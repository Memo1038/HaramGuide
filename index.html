<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø±Ø´Ø¯ Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ø°ÙƒÙŠ</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --primary: #1b5e20; --accent: #c69c6d; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; }
        
        #map { height: 100vh; width: 100%; z-index: 1; filter: grayscale(20%); }

        /* Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ© ØªØ·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
        #location-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px; box-sizing: border-box;
        }

        .share-btn {
            background: var(--primary); color: white; border: none; padding: 20px 40px;
            border-radius: 50px; font-size: 20px; font-weight: bold; cursor: pointer;
            box-shadow: 0 10px 20px rgba(27, 94, 32, 0.3); transition: 0.3s;
        }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        .ui-container {
            position: absolute; bottom: 20px; left: 10px; right: 10px; z-index: 2000;
        }

        .search-bar {
            background: white; padding: 12px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 10px;
        }

        #searchInput {
            width: 100%; border: none; font-size: 16px; outline: none; text-align: right;
        }

        .info-card {
            background: var(--primary); color: white; padding: 15px; border-radius: 15px;
            display: flex; justify-content: space-around; text-align: center;
        }

        .stat b { display: block; font-size: 18px; }
        .stat span { font-size: 12px; opacity: 0.8; }

        .search-results {
            background: white; border-radius: 10px; max-height: 150px; 
            overflow-y: auto; display: none; margin-bottom: 5px;
        }
        .res-item { padding: 12px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div id="location-overlay">
    <div style="font-size: 50px; margin-bottom: 20px;">ğŸ“</div>
    <h2 style="color: var(--primary);">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø­Ø±Ù…</h2>
    <p>Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙƒØ§Ù†Ùƒ ÙˆØªÙˆØ¬ÙŠÙ‡Ùƒ Ù„Ù„Ø£Ø¨ÙˆØ§Ø¨ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡</p>
    <button class="share-btn" onclick="activateGPS()">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¢Ù†</button>
</div>

<div id="map"></div>

<div class="ui-container">
    <div id="results" class="search-results"></div>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† (Ø¨Ø§Ø¨ØŒ Ø²Ù…Ø²Ù…ØŒ Ø­Ù…Ø§Ù…Ø§Øª...)" oninput="doSearch()">
    </div>
    <div class="info-card">
        <div class="stat"><b id="distText">0</b><span>Ù…ØªØ±</span></div>
        <div class="stat"><b id="stepText">0</b><span>Ø®Ø·ÙˆØ©</span></div>
        <div class="stat"><b id="locationName">--</b><span>Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</span></div>
    </div>
</div>

<script>
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ø£Ù…Ø§ÙƒÙ†
    const points = [
        { name: "Ø§Ù„ÙƒØ¹Ø¨Ø© Ø§Ù„Ù…Ø´Ø±ÙØ©", lat: 21.422487, lng: 39.826206 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ²", lat: 21.4204, lng: 39.8257 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯", lat: 21.4214, lng: 39.8235 },
        { name: "Ø­Ù…Ø§Ù…Ø§Øª Ø§Ù„Ø³Ø§Ø­Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", lat: 21.4245, lng: 39.8305 },
        { name: "Ù†Ù‚Ø·Ø© Ø²Ù…Ø²Ù… Ø§Ù„ØµØ­Ù†", lat: 21.4228, lng: 39.8265 }
    ];

    var map = L.map('map', { zoomControl: false }).setView([21.4225, 39.8262], 18);
    var userMarker, polyline = L.polyline([], {color: '#c69c6d', weight: 6}).addTo(map);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    function activateGPS() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(onFirstSuccess, onError, {enableHighAccuracy: true});
        } else {
            alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
        }
    }

    function onFirstSuccess(pos) {
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ©
        document.getElementById('location-overlay').style.display = 'none';
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø­ÙŠ
        navigator.geolocation.watchPosition(updateUserLocation, onError, {
            enableHighAccuracy: true,
            maximumAge: 0
        });
    }

    function updateUserLocation(pos) {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        const currentPos = [lat, lng];

        if (!userMarker) {
            userMarker = L.circleMarker(currentPos, {radius: 8, color: '#007aff', fillOpacity: 1, fillColor: '#007aff'}).addTo(map);
        } else {
            userMarker.setLatLng(currentPos);
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù‚Ø±ÙŠØ¨
        let closest = "Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ù…";
        points.forEach(p => {
            if(map.distance(currentPos, [p.lat, p.lng]) < 30) closest = p.name;
        });
        document.getElementById('locationName').innerText = closest;
    }

    function onError(err) {
        alert("ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ Ù„ÙƒÙŠ ÙŠØ¹Ù…Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚");
    }

    function doSearch() {
        let q = document.getElementById('searchInput').value;
        let res = document.getElementById('results');
        res.innerHTML = '';
        if(q.length < 1) { res.style.display = 'none'; return; }

        points.filter(p => p.name.includes(q)).forEach(p => {
            let d = document.createElement('div');
            d.className = 'res-item';
            d.innerText = p.name;
            d.onclick = () => {
                let dest = [p.lat, p.lng];
                let start = userMarker ? userMarker.getLatLng() : [21.4225, 39.8262];
                polyline.setLatLngs([start, dest]);
                let distance = map.distance(start, dest).toFixed(0);
                document.getElementById('distText').innerText = distance;
                document.getElementById('stepText').innerText = Math.round(distance / 0.75);
                res.style.display = 'none';
                map.fitBounds(polyline.getBounds(), {padding: [50,50]});
            };
            res.appendChild(d);
        });
        res.style.display = 'block';
    }
</script>
</body>
</html>
