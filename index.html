<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø±Ø´Ø¯ Ø§Ù„Ø­Ø±Ù… - Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --gold: #c69c6d; --green: #1b5e20; }
        body { margin: 0; font-family: sans-serif; background: #000; height: 100vh; overflow: hidden; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ø¹ Ø²Ø± ØªØ®Ø·ÙŠ ÙÙŠ Ø­Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ */
        #welcome-screen {
            position: fixed; inset: 0; z-index: 10000;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.8)), 
                        url('https://images.unsplash.com/photo-1542810634-71277d95dcbb?q=80&w=1000&auto=format&fit=crop');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center;
        }

        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--gold); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .skip-btn { margin-top: 20px; background: none; border: 1px solid white; color: white; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-size: 14px; }

        #map { height: 100vh; width: 100%; z-index: 1; }

        .ui-overlay { position: absolute; inset: 0; pointer-events: none; z-index: 1000; display: flex; flex-direction: column; }
        .ui-overlay > * { pointer-events: auto; }

        .header { background: rgba(255,255,255,0.95); margin: 10px; padding: 12px; border-radius: 12px; color: var(--green); text-align: center; font-weight: bold; font-size: 13px; }

        .menu-container { margin-top: auto; background: white; border-radius: 20px 20px 0 0; padding: 15px; max-height: 50%; overflow-y: auto; color: #333; }
        .tabs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; }
        .tab { padding: 8px 15px; background: #eee; border-radius: 20px; font-size: 12px; white-space: nowrap; cursor: pointer; }
        .tab.active { background: var(--green); color: white; }

        .list-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; }
        .go-btn { background: var(--gold); color: white; border: none; padding: 6px 15px; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<div id="welcome-screen">
    <div class="loader"></div>
    <h2 id="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø´Ø§Ø±Ø© GPS...</h2>
    <p>ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ "Ø§Ù„Ù…ÙˆÙ‚Ø¹" ÙÙŠ Ù‡Ø§ØªÙÙƒ</p>
    <button class="skip-btn" onclick="forceStart()">Ø¯Ø®ÙˆÙ„ ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø®Ø±ÙŠØ·Ø©</button>
</div>

<div class="ui-overlay">
    <div class="header" id="status">ğŸ“ Ø­Ø¯Ø¯ ÙˆØ¬Ù‡ØªÙƒ ÙÙŠ Ø§Ù„Ø­Ø±Ù…</div>
    <div class="menu-container">
        <div class="tabs">
            <div class="tab active" onclick="showCat('ground')">Ø§Ù„Ø£Ø±Ø¶ÙŠ</div>
            <div class="tab" onclick="showCat('saei')">Ø§Ù„Ø³Ø¹ÙŠ</div>
            <div class="tab" onclick="showCat('toilets')">Ø§Ù„Ø­Ù…Ø§Ù…Ø§Øª</div>
        </div>
        <div id="items-list"></div>
    </div>
</div>

<div id="map"></div>

<script>
    const data = {
        ground: [{ name: "Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯", lat: 21.4214, lng: 39.8235 }, { name: "Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ²", lat: 21.4204, lng: 39.8257 }],
        saei: [{ name: "Ø§Ù„ØµØ§ÙØ§", lat: 21.4215, lng: 39.8275 }, { name: "Ø§Ù„Ù…Ø±ÙˆØ©", lat: 21.4255, lng: 39.8282 }],
        toilets: [{ name: "Ø­Ù…Ø§Ù…Ø§Øª Ø§Ù„Ù‚Ø´Ø§Ø´ÙŠØ©", lat: 21.4245, lng: 39.8305 }, { name: "Ø­Ù…Ø§Ù…Ø§Øª Ø§Ù„Ø´Ø¨ÙŠÙƒØ©", lat: 21.4210, lng: 39.8210 }]
    };

    let map, userMkr, targetMkr;

    function initMap() {
        map = L.map('map', { zoomControl: false }).setView([21.4225, 39.8262], 17);
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map);
        showCat('ground');
    }

    function requestLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    forceStart(); // Ø¥Ø°Ø§ Ù†Ø¬Ø­ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ØŒ Ø§Ø¯Ø®Ù„ ÙÙˆØ±Ø§Ù‹
                    const u = [pos.coords.latitude, pos.coords.longitude];
                    userMkr = L.circleMarker(u, { radius: 8, fillColor: '#007aff', color: '#fff', fillOpacity: 1 }).addTo(map);
                    map.panTo(u);
                },
                (err) => {
                    console.log("GPS Error: ", err);
                    document.getElementById('loading-text').innerText = "ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹.";
                },
                { enableHighAccuracy: true, timeout: 5000 }
            );
        }
    }

    function forceStart() {
        document.getElementById('welcome-screen').style.display = 'none';
        if (!map) initMap();
    }

    function showCat(cat) {
        const list = document.getElementById('items-list');
        list.innerHTML = '';
        data[cat].forEach(item => {
            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerHTML = `<span>${item.name}</span> <button class="go-btn" onclick="setTarget(${item.lat}, ${item.lng})">Ø§Ù†ØªÙ‚Ø§Ù„</button>`;
            list.appendChild(div);
        });
    }

    function setTarget(lat, lng) {
        if (targetMkr) map.removeLayer(targetMkr);
        targetMkr = L.marker([lat, lng]).addTo(map);
        map.setView([lat, lng], 18);
    }

    // Ø§Ø¨Ø¯Ø£ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙˆØ±Ø§Ù‹
    initMap();
    requestLocation();
</script>
</body>
</html>
