<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø±Ø´Ø¯ Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ø´Ø§Ù…Ù„ | Ù…Ø­Ù…Ø¯ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --primary: #1b5e20; --accent: #c69c6d; --bg: #f8f9fa; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; height: 100vh; background: var(--bg); overflow: hidden; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 9999; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center; padding: 30px; box-sizing: border-box;
        }

        .main-btn {
            background: var(--primary); color: white; border: none; padding: 18px 45px;
            border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer;
            box-shadow: 0 10px 25px rgba(27, 94, 32, 0.3);
        }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        .top-bar {
            position: absolute; top: 15px; left: 10px; right: 10px; z-index: 1000;
            background: white; padding: 12px 20px; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 10px;
        }
        .pulse { height: 12px; width: 12px; background: #2ecc71; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); } }

        .bottom-panel { position: absolute; bottom: 25px; left: 10px; right: 10px; z-index: 1000; }
        .search-results { background: white; border-radius: 12px; max-height: 200px; overflow-y: auto; display: none; margin-bottom: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .res-item { padding: 15px; border-bottom: 1px solid #eee; font-size: 14px; text-align: right; cursor: pointer; }
        
        .search-input { width: 100%; padding: 16px; border-radius: 15px; border: none; box-shadow: 0 4px 20px rgba(0,0,0,0.15); font-size: 16px; margin-bottom: 10px; outline: none; box-sizing: border-box; text-align: right; }
        .stats-box { background: var(--primary); color: white; padding: 15px; border-radius: 18px; display: flex; justify-content: space-around; }
        .stat-item b { display: block; font-size: 19px; }
        .stat-item span { font-size: 11px; opacity: 0.9; }
    </style>
</head>
<body>

<div id="welcome-screen">
    <div style="font-size: 60px; margin-bottom: 10px;">ğŸ•‹</div>
    <h2 style="color: var(--primary);">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ø°ÙƒÙŠ</h2>
    <p>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø­Ù…Ø¯.. Ø§Ø¶ØºØ· Ù„ØªÙØ¹ÙŠÙ„ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ù… Ø§Ù„Ø´Ø§Ù…Ù„Ø©</p>
    <button class="main-btn" onclick="requestLocation()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ù…</button>
</div>

<div class="top-bar">
    <div class="pulse"></div>
    <span id="currentPlaceName" style="font-weight: bold; font-size: 14px;">Ø£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ: ÙÙŠ Ø±Ø­Ø§Ø¨ Ø§Ù„Ø­Ø±Ù…</span>
</div>

<div id="map"></div>

<div class="bottom-panel">
    <div id="searchResults" class="search-results"></div>
    <input type="text" class="search-input" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù†: Ø¨Ø§Ø¨ØŒ Ù…ØµÙ„Ù‰ØŒ Ø²Ù…Ø²Ù…ØŒ Ø¯ÙˆØ±Ø§Øª Ù…ÙŠØ§Ù‡..." oninput="search()">
    <div class="stats-box">
        <div class="stat-item"><b id="dVal">0</b><span>Ù…ØªØ± Ù„Ù„Ù‡Ø¯Ù</span></div>
        <div class="stat-item"><b id="sVal">0</b><span>Ø®Ø·ÙˆØ©</span></div>
    </div>
</div>

<script>
    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø±Ù… (Ø¯Ø§Ø®Ù„ÙŠØ© ÙˆØ®Ø§Ø±Ø¬ÙŠØ©)
    const destinations = [
        { name: "Ø§Ù„ÙƒØ¹Ø¨Ø© Ø§Ù„Ù…Ø´Ø±ÙØ© - ØµØ­Ù† Ø§Ù„Ù…Ø·Ø§Ù", lat: 21.4225, lng: 39.8262 },
        { name: "Ø­Ø¬Ø± Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„", lat: 21.4227, lng: 39.8261 },
        { name: "Ù…Ù‚Ø§Ù… Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", lat: 21.4226, lng: 39.8264 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² (1)", lat: 21.4204, lng: 39.8257 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ (79)", lat: 21.4214, lng: 39.8235 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø±Ø© (62)", lat: 21.4237, lng: 39.8248 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„ÙØªØ­ (45)", lat: 21.4246, lng: 39.8263 },
        { name: "Ø¬Ø¨Ù„ Ø§Ù„ØµÙØ§ - Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø¹Ù‰", lat: 21.4215, lng: 39.8275 },
        { name: "Ø¬Ø¨Ù„ Ø§Ù„Ù…Ø±ÙˆØ© - Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø¹Ù‰", lat: 21.4255, lng: 39.8282 },
        { name: "ØªÙˆØ³Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡", lat: 21.4255, lng: 39.8245 },
        { name: "ØµÙ†Ø§Ø¨ÙŠØ± Ù…ÙŠØ§Ù‡ Ø²Ù…Ø²Ù… - Ø§Ù„ØµØ­Ù†", lat: 21.4228, lng: 39.8265 },
        { name: "Ø¯ÙˆØ±Ø§Øª Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³Ø§Ø­Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", lat: 21.4245, lng: 39.8305 },
        { name: "Ù…ØµØ§Ø¹Ø¯ Ø§Ù„Ø£Ø¨Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¤Ø¯ÙŠØ© Ù„Ù„Ø­Ø±Ù…", lat: 21.4195, lng: 39.8250 },
        { name: "Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ù…ÙƒÙŠ", lat: 21.4240, lng: 39.8290 }
    ];

    const haramDefault = [21.4225, 39.8262];
    let map = L.map('map', { zoomControl: false }).setView(haramDefault, 18);
    let userMarker, pathLine = L.polyline([], {color: '#c69c6d', weight: 6}).addTo(map);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    function requestLocation() {
        document.getElementById('welcome-screen').style.display = 'none';
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(updatePosition, handleError, {enableHighAccuracy: true});
        } else { handleError(); }
    }

    function updatePosition(pos) {
        const uPos = [pos.coords.latitude, pos.coords.longitude];
        if (!userMarker) {
            userMarker = L.circleMarker(uPos, {radius: 10, color: 'white', weight: 3, fillOpacity: 1, fillColor: '#007aff'}).addTo(map);
            map.panTo(uPos);
        } else { userMarker.setLatLng(uPos); }

        let placeName = "Ø³Ø§Ø­Ø© Ø§Ù„Ø­Ø±Ù…";
        destinations.forEach(d => {
            if(map.distance(uPos, [d.lat, d.lng]) < 35) placeName = d.name;
        });
        document.getElementById('currentPlaceName').innerText = "Ø£Ù†Øª Ù‡Ù†Ø§ ÙÙŠ (" + placeName + ")";
    }

    function handleError() {
        if (!userMarker) {
            userMarker = L.circleMarker(haramDefault, {radius: 10, color: 'white', weight: 3, fillOpacity: 1, fillColor: '#888'}).addTo(map);
        }
        document.getElementById('currentPlaceName').innerText = "Ø£Ù†Øª Ù‡Ù†Ø§ ÙÙŠ (Ù…ÙˆÙ‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ)";
    }

    function search() {
        let q = document.getElementById('searchInput').value.toLowerCase();
        let res = document.getElementById('searchResults');
        res.innerHTML = '';
        if(!q) { res.style.display = 'none'; return; }

        destinations.filter(d => d.name.includes(q)).forEach(d => {
            let item = document.createElement('div');
            item.className = 'res-item';
            item.innerText = d.name;
            item.onclick = () => {
                let start = userMarker ? userMarker.getLatLng() : haramDefault;
                let end = [d.lat, d.lng];
                pathLine.setLatLngs([start, end]);
                let dist = map.distance(start, end);
                document.getElementById('dVal').innerText = dist.toFixed(0);
                document.getElementById('sVal').innerText = Math.round(dist / 0.7);
                res.style.display = 'none';
                map.fitBounds(pathLine.getBounds(), {padding: [70,70]});
            };
            res.appendChild(item);
        });
        res.style.display = 'block';
    }
</script>
</body>
</html>
