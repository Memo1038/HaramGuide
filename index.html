<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نموذج خريطة المسجد الحرام</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
 integrity="sha256-sA+uChXtYfTVjX8x9Ck2w6JQ0R3lGi5rX3GZ0z9gALQ=" crossorigin=""/>

<style>
  body { margin:0; padding:0; font-family: Arial, sans-serif; }
  #map { height: 100vh; width: 100vw; }
  .custom-popup { text-align:right; font-size:16px; }
  .btn { padding:5px 10px; margin-top:5px; background:#4A90E2; color:white; border:none; cursor:pointer; border-radius:4px; }
  .btn:hover { background:#357ABD; }
</style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
 integrity="sha256-o9N1j8w+9t0ZbW2u5OJuvGxR2o7jHJz7s6TP0hZjHDo=" crossorigin=""></script>

<script>
// ======== 1. إعداد الخريطة ========
var map = L.map('map', {
  crs: L.CRS.Simple, // لخريطة صورة داخلية
  minZoom: -1,
  maxZoom: 4
});

// ======== 2. تحميل صورة خريطة المسجد الحرام ========
// استخدم هنا أي صورة للخريطة الداخلية (يفضل PNG أو JPG)
var bounds = [[0,0], [1000,1000]]; // إحداثيات الصورة (يمكن تعديلها حسب حجم الصورة)
var image = L.imageOverlay('https://i.imgur.com/WlN4T1K.jpg', bounds).addTo(map);

map.fitBounds(bounds);

// ======== 3. نقاط الخدمات ========
var services = [
  {name: "دورة مياه النساء", coords: [150,200]},
  {name: "دورة مياه الرجال", coords: [800,200]},
  {name: "مصعد", coords: [500,500]},
  {name: "بوابة رئيسية", coords: [100,900]},
  {name: "نقطة زمزم", coords: [900,900]},
  {name: "مكتب المفقودات", coords: [700,700]}
];

services.forEach(function(s) {
  var marker = L.marker(s.coords).addTo(map)
    .bindPopup(`<div class="custom-popup">
      <strong>${s.name}</strong>
      <br><button class="btn" onclick="navigateTo(${s.coords[0]}, ${s.coords[1]})">اذهب إلى هنا</button>
    </div>`);
});

// ======== 4. تحديد موقع المستخدم يدوي ========
var userMarker;
function setUserLocation(lat, lng){
  if(userMarker) map.removeLayer(userMarker);
  userMarker = L.marker([lat,lng], {icon: L.icon({
    iconUrl: 'https://i.imgur.com/4g7TZyf.png', // أيقونة المستخدم
    iconSize: [30,30]
  })}).addTo(map).bindPopup("موقعك الحالي").openPopup();
  map.panTo([lat,lng]);
}

// مثال: ضع المستخدم في نقطة أولية
setUserLocation(200,200);

// ======== 5. وظيفة التوجيه خطوة بخطوة ========
var routeLine;
function navigateTo(lat, lng){
  if(!userMarker) {
    alert("حدد موقعك أولاً!");
    return;
  }
  if(routeLine) map.removeLayer(routeLine);
  var start = userMarker.getLatLng();
  var end = L.latLng(lat,lng);
  // رسم خط مستقيم كمحاكاة للتوجيه
  routeLine = L.polyline([start,end], {color:'red', weight:4, dashArray
