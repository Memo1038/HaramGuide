<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ø°ÙƒÙŠ - Ù…Ø­Ù…Ø¯ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --haram-green: #1b5e20; --gold: #c69c6d; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #f0f2f5; overflow: hidden; }
        #map { height: 60vh; width: 100%; z-index: 1; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« */
        .search-container { position: absolute; top: 15px; left: 15px; right: 15px; z-index: 1000; }
        #searchInput {
            width: 100%; padding: 12px 20px; border-radius: 25px; border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 16px; outline: none;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙÙ„ÙŠØ© */
        .info-panel {
            height: 40vh; background: white; border-radius: 25px 25px 0 0;
            padding: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            position: relative; z-index: 1000; display: flex; flex-direction: column;
        }

        .stats-row { display: flex; justify-content: space-around; margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 15px; }
        .stat-box { text-align: center; }
        .stat-val { display: block; font-size: 20px; font-weight: bold; color: var(--haram-green); }
        .stat-label { font-size: 12px; color: #666; }

        .floor-selector { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .floor-btn { padding: 8px 18px; border: 1px solid #ddd; border-radius: 20px; background: white; white-space: nowrap; cursor: pointer; }
        .floor-btn.active { background: var(--haram-green); color: white; border: none; }

        .nav-actions { margin-top: auto; display: flex; gap: 10px; }
        .btn-start { flex: 2; background: var(--haram-green); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .btn-reset { flex: 1; background: #eee; border: none; border-radius: 12px; cursor: pointer; }

        .search-results {
            position: absolute; top: 55px; left: 0; right: 0; background: white;
            border-radius: 10px; max-height: 250px; overflow-y: auto; display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid #eee;
        }
        .result-item { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; justify-content: space-between; }
        .result-item:hover { background: #f9f9f9; }
        .result-tag { font-size: 10px; background: #e8f5e9; color: var(--haram-green); padding: 2px 8px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="search-container">
    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù†: Ø¨Ø§Ø¨ØŒ Ø²Ù…Ø²Ù…ØŒ Ø­Ù…Ø§Ù…Ø§ØªØŒ Ø§Ù„ØµÙØ§..." oninput="searchLocation()">
    <div id="searchResults" class="search-results"></div>
</div>

<div id="map"></div>

<div class="info-panel">
    <div class="floor-selector" id="floorSelector">
        <button class="floor-btn active" onclick="filterByFloor('Ø§Ù„Ø£Ø±Ø¶ÙŠ', this)">Ø§Ù„Ø£Ø±Ø¶ÙŠ</button>
        <button class="floor-btn" onclick="filterByFloor('Ø§Ù„Ù…Ø³Ø¹Ù‰', this)">Ø§Ù„Ù…Ø³Ø¹Ù‰</button>
        <button class="floor-btn" onclick="filterByFloor('Ø§Ù„Ø£ÙˆÙ„', this)">Ø§Ù„Ø£ÙˆÙ„</button>
        <button class="floor-btn" onclick="filterByFloor('Ø§Ù„Ù‚Ø¨Ùˆ', this)">Ø§Ù„Ù‚Ø¨Ùˆ</button>
        <button class="floor-btn" onclick="filterByFloor('Ø®Ø§Ø±Ø¬ÙŠ', this)">Ø§Ù„Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©</button>
    </div>

    <div class="stats-row">
        <div class="stat-box">
            <span class="stat-val" id="distVal">0</span>
            <span class="stat-label">Ø§Ù„Ù…Ø³Ø§ÙØ© (Ù…ØªØ±)</span>
        </div>
        <div class="stat-box">
            <span class="stat-val" id="stepVal">0</span>
            <span class="stat-label">Ø§Ù„Ø®Ø·ÙˆØ§Øª</span>
        </div>
        <div class="stat-box">
            <span class="stat-val" id="timeVal">0</span>
            <span class="stat-label">Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚</span>
        </div>
    </div>

    <div class="nav-actions">
        <button class="btn-start" onclick="startSimulation()">Ø¨Ø¯Ø¡ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø­Ø±ÙƒØ© ğŸš¶â€â™‚ï¸</button>
        <button class="btn-reset" onclick="location.reload()">ğŸ”„</button>
    </div>
</div>

<script>
    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø§Ù…Ù„Ø© Ù„ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„Ø­Ø±Ù…
    const locations = [
        // Ø§Ù„Ø£Ø±Ø¶ÙŠ - Ø£Ø¨ÙˆØ§Ø¨
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² (1)", type: "gate", floor: "Ø§Ù„Ø£Ø±Ø¶ÙŠ", lat: 21.4204, lng: 39.8257 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ (79)", type: "gate", floor: "Ø§Ù„Ø£Ø±Ø¶ÙŠ", lat: 21.4214, lng: 39.8235 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø±Ø© (62)", type: "gate", floor: "Ø§Ù„Ø£Ø±Ø¶ÙŠ", lat: 21.4237, lng: 39.8248 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„Ø³Ù„Ø§Ù…", type: "gate", floor: "Ø§Ù„Ø£Ø±Ø¶ÙŠ", lat: 21.4230, lng: 39.8275 },
        { name: "Ø¨Ø§Ø¨ Ø§Ù„ÙØªØ­", type: "gate", floor: "Ø§Ù„Ø£Ø±Ø¶ÙŠ", lat: 21.4245, lng: 39.8255 },
        
        // Ø²Ù…Ø²Ù…
        { name: "Ù…Ø¨Ø±Ø¯Ø§Øª Ø²Ù…Ø²Ù… - Ø§Ù„ØµØ­Ù†", type: "water", floor: "Ø§Ù„Ø£Ø±Ø¶ÙŠ", lat: 21.4228, lng: 39.8265 },
        { name: "Ø²Ù…Ø²Ù… - ØªÙˆØ³Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯", type: "water", floor: "Ø§Ù„Ø£Ø±Ø¶ÙŠ", lat: 21.4218, lng: 39.8242 },
        
        // Ø§Ù„Ù…Ø³Ø¹Ù‰
        { name: "Ø¬Ø¨Ù„ Ø§Ù„ØµÙØ§", type: "holy", floor: "Ø§Ù„Ù…Ø³Ø¹Ù‰", lat: 21.4215, lng: 39.8275 },
        { name: "Ø¬Ø¨Ù„ Ø§Ù„Ù…Ø±ÙˆØ©", type: "holy", floor: "Ø§Ù„Ù…Ø³Ø¹Ù‰", lat: 21.4255, lng: 39.8282 },
        { name: "Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‡Ø±ÙˆÙ„Ø© (Ø§Ù„Ø¹Ù„Ù…ÙŠÙ†)", type: "holy", floor: "Ø§Ù„Ù…Ø³Ø¹Ù‰", lat: 21.4235, lng: 39.8278 },

        // Ø®Ø§Ø±Ø¬ÙŠ - Ø­Ù…Ø§Ù…Ø§Øª ÙˆØ®Ø¯Ù…Ø§Øª
        { name: "Ø­Ù…Ø§Ù…Ø§Øª Ø§Ù„Ø³Ø§Ø­Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", type: "wc", floor: "Ø®Ø§Ø±Ø¬ÙŠ", lat: 21.4245, lng: 39.8305 },
        { name: "Ø­Ù…Ø§Ù…Ø§Øª Ø§Ù„Ø³Ø§Ø­Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©", type: "wc", floor: "Ø®Ø§Ø±Ø¬ÙŠ", lat: 21.4195, lng: 39.8215 },
        { name: "Ù…ÙƒØªØ¨ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø§Øª", type: "service", floor: "Ø®Ø§Ø±Ø¬ÙŠ", lat: 21.4235, lng: 39.8220 },
        { name: "Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ø³Ø¹Ø§Ù Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ", type: "medical", floor: "Ø®Ø§Ø±Ø¬ÙŠ", lat: 21.4250, lng: 39.8270 },

        // Ø§Ù„Ù‚Ø¨Ùˆ
        { name: "Ù…ØµÙ„Ù‰ Ø§Ù„Ù‚Ø¨Ùˆ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ", type: "prayer", floor: "Ø§Ù„Ù‚Ø¨Ùˆ", lat: 21.4210, lng: 39.8230 },
        { name: "Ù…Ø®Ø§Ø±Ø¬ Ø§Ù„Ø³Ù„Ø§Ù„Ù… Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©", type: "elevator", floor: "Ø§Ù„Ù‚Ø¨Ùˆ", lat: 21.4225, lng: 39.8240 }
    ];

    let userPos = [21.4204, 39.8257]; 
    let map = L.map('map', { zoomControl: false }).setView(userPos, 18);
    let userMarker = L.marker(userPos).addTo(map).bindPopup("Ø£Ù†Øª Ù‡Ù†Ø§");
    let polyline = L.polyline([], {color: '#c69c6d', weight: 6, opacity: 0.8}).addTo(map);
    let markersLayer = L.layerGroup().addTo(map);

    L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}', {
        maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3']
    }).addTo(map);

    function filterByFloor(floor, btn) {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.querySelectorAll('.floor-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // Ù…Ø³Ø­ Ø§Ù„Ù…Ø§Ø±ÙƒØ±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ± ÙÙ‚Ø·
        markersLayer.clearLayers();
        locations.filter(l => l.floor === floor).forEach(loc => {
            L.marker([loc.lat, loc.lng]).addTo(markersLayer).bindPopup(loc.name);
        });
    }

    function searchLocation() {
        let query = document.getElementById('searchInput').value.toLowerCase();
        let resultsDiv = document.getElementById('searchResults');
        resultsDiv.innerHTML = '';
        
        if(query.length < 1) { resultsDiv.style.display = 'none'; return; }

        let filtered = locations.filter(l => l.name.includes(query) || l.floor.includes(query));
        filtered.forEach(loc => {
            let div = document.createElement('div');
            div.className = 'result-item';
            div.innerHTML = `<span>${loc.name}</span> <span class="result-tag">${loc.floor}</span>`;
            div.onclick = () => selectDestination(loc);
            resultsDiv.appendChild(div);
        });
        resultsDiv.style.display = 'block';
    }

    let targetPos = null;

    function selectDestination(loc) {
        targetPos = [loc.lat, loc.lng];
        document.getElementById('searchResults').style.display = 'none';
        document.getElementById('searchInput').value = loc.name;
        polyline.setLatLngs([userPos, targetPos]);
        map.fitBounds(polyline.getBounds(), {padding: [50, 50]});
        updateStats(userPos, targetPos);
    }

    function updateStats(p1, p2) {
        let d = map.distance(p1, p2).toFixed(0);
        document.getElementById('distVal').innerText = d;
        document.getElementById('stepVal').innerText = Math.round(d / 0.75);
        document.getElementById('timeVal').innerText = Math.round(d / 80);
    }

    function startSimulation() {
        if(!targetPos) { alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ¬Ù‡Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¨Ø­Ø«"); return; }
        let steps = 40; let count = 0;
        let interval = setInterval(() => {
            count++;
            let lat = userPos[0] + (targetPos[0] - userPos[0]) * (count/steps);
            let lng = userPos[1] + (targetPos[1] - userPos[1]) * (count/steps);
            let currentPos = [lat, lng];
            userMarker.setLatLng(currentPos);
            polyline.setLatLngs([currentPos, targetPos]);
            updateStats(currentPos, targetPos);
            if(count >= steps) { clearInterval(interval); alert("ÙˆØµÙ„Øª Ø¨Ø­Ù…Ø¯ Ø§Ù„Ù„Ù‡"); }
        }, 300);
    }

    // Ø¹Ø±Ø¶ Ù…Ø§Ø±ÙƒØ±Ø§Øª Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø£Ø±Ø¶ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    filterByFloor('Ø§Ù„Ø£Ø±Ø¶ÙŠ', document.querySelector('.floor-btn'));
</script>

</body>
</html>